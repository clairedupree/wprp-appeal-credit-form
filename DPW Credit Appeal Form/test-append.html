<!doctype html>
<html lang="en">

<head>
	<meta charset="utf-8">

	<!-- REMOTE Bootstrap CSS -->
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.3.1/dist/css/bootstrap.min.css"
		integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
  <!---->
  
  <!-- LOCAL Bootstrap CSS -->
  <link rel="stylesheet" href="https://www.aacounty.org/_template-assets/css/bootstrap4-iso.min.css" />
  <!---->

	<!-- FontAwesome Icon Library -->
	<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.6.3/css/all.css"
		integrity="sha384-UHRtZLI+pbxtHCWp1t77Bi1L4ZtiqrqD80Kn4Z8NTSRyMA2Fd33n5dQ8lWUE00s/" crossorigin="anonymous">

  <title>TEST APPEND</title>

  <!-- Embedded styles -->
	<style>
		.requiredField {
			color: red;
		}

    i {
      margin-right: 5px;
    }

    /* .appealOptions initialized to not visible because of multi-select mechanism, .creditOptions are single-select*/
    .common, .uncommon, .creditApplication, .appealApplication  {
      display: none;
    }
    

    .row {
      /* using .form-group for padding */
      /* .row used for organization & responsiveness */
        padding: 0px !important;
        background: none !important;
        border-top: 0px !important;
        margin: auto !important;
    }
    
    .dropdown-menu {
      text-align: center !important;
    }
	</style>

</head>



<body>
  <div class="bootstrap-iso">

  <!-- Navigation -->
  <div id="navigation" style="display: none">
    <div class="row">

      <!-- Error message box -->
      <div class="col-8 form-group">
        <p id="showError" class="requiredField" style="text-align: center">Text should be replaced by an error message</p>
      </div>

      <!-- Go Back button -->
      <div id="backButton" class="col-4 form-group">
        <button class="btn btn-light btn-block">Go Back</button>
      </div>
    </div>
  </div>  
  
  



  <!-- SELECT APPLICATION -->
  <div id="applicationSelect">

    <div class="row applicationSelect">
      <div class="col-6">
        <button class="btn btn-dark btn-block" name="appeal" id="appealButton"><i class='far fa-comment'></i>Appeal</button>
      </div>
      
      <div class="col-6 applicationSelect">
        <button class="btn btn-dark btn-block" name="credit" id="creditButton"><i class='fas fa-edit'></i>Credit</button>
      </div>
    </div>  
  </div>




  <!-- SELECT TYPE -->
  <div id="typeSelect">

    <!-- Select Appeal Type(s) -->
    <div id="appeal" style="display: none">
      <div class="row">
        <div id="appealChecks" class="col-12 form-group">
          <h5>Select the reason(s) for the appeal:</h5>

          <div class="form-check">
            <input class="form-check-input" type="checkbox" id="appealType1" name="appealCheckbox" 
              value="Property placed in wrong residential tier">
            <label class="form-check-label" for="appealType1">Property placed in wrong residential tier</label>
          </div>

          <div class="form-check">
            <input class="form-check-input" type="checkbox" id="appealType2" name="appealCheckbox" 
              value="Incorrect classification of property">
            <label class="form-check-label" for="appealType2">Incorrect classification of property</label>
          </div>

          <div class="form-check">
            <input class="form-check-input" type="checkbox" id="appealType3" name="appealCheckbox" 
              value="Homeowner's Association property where the fee cap is applicable but was not applied">
            <label class="form-check-label" for="appealType3">Homeowner's Association property where the fee cap is applicable but was not applied</label>
          </div>

          <div class="form-check">
            <input class="form-check-input" type="checkbox" id="appealType4" name="appealCheckbox" 
              value="Mathematical error or incorrect impervious surface calculation">
            <label class="form-check-label" for="appealType3">Mathematical error or incorrect impervious surface calculation</label>
          </div>

          <div class="form-check">
            <input class="form-check-input" type="checkbox" id="appealType5" name="appealCheckbox" 
              value="Exempt or incorrect property owner">
            <label class="form-check-label" for="appealType3">Exempt or incorrect property owner</label>
          </div>

        </div> 
      </div>

      <!-- event listener validates checkboxes on click -->
      <div class="row">
        <div class="col-12 text-center form-group">
          <button type="button" class="btn btn-primary" id="continueButton">Continue</button>
        </div>
      </div>
    </div>

    

    <!-- Select Credit Type -->
    <div id="credit" style="display: none">
      <div class="row">
        <div class="col-12 form-group">
          <h5>Select the credit type:</h5>
          <button class="btn btn-light btn-block" value="Property not under an NPDES permit" 
            id="creditType1" onclick="showCreditApplication('creditType1')">Property not under an NPDES	permit</button>
          <button class="btn btn-light btn-block" value="Property with an NPDES permit that includes stormwater management controls" 
            id="creditType2" onclick="showCreditApplication('creditType2')">Property with an NPDES permit that includes	stormwater management controls</button>
        </div>
      </div>
    </div>



    <!-- Main Application Type Header -->
    <div class="row" style="display: none">
      <div class="col-12">
          <h4 id="appealHeader" class="appealApplication uncommon">Stormwater Fee Appeal Application</h4>
          <h4 id="creditHeader" class="creditApplication uncommon">Stormwater Credit Application</h4>
        </div>
      </div>

  </div> <!-- end type select -->


  <!-- SHOW FORM -->
	<div id="formContainer">
	  <!-- Form -->
		<form id="dpwAppealCreditApplication" name="dpwAppealCreditApplication" class="form">

      <!-- COMMON BEGINNING -->
      <div id="commonBeginning" class="common">

        <!-- Owner Information -->
        <div class="row">
          <div class="col-12">
            <h5>Owner Information</h5>
          </div>
        </div>

        <div class="row">
          <div class="col-sm-12 col-md-6 col-lg-6 col-xl-6">
            <div class="form-group">
              <label for="constituentFirstName">First Name: <span class="requiredField">*</span></label>
              <input type="text"  name="constituentFirstName" id="constituentFirstName" class="form-control"  >
            </div>
          </div>

          <div class="col-sm-12 col-md-6 col-lg-6 col-xl-6">
            <div class="form-group">
              <label for="constituentLastName">Last Name: <span class="requiredField">*</span></label>
              <input type="text" name="constituentLastName" id="constituentLastName" class="form-control"  >
            </div>
          </div>
        </div>

        <div class="row">  
          <div class="col-12">
            <div class="form-group">
              <label for="constituentOrganization">Company / Organization (if applicable):</label>
              <input type="text" name="constituentOrganization" id="constituentOrganization" class="form-control">
            </div>
          </div>
        </div>

        <!-- Tax Account(s) -->
        <div class="row">
          <div class="col-12">
            <h5>Tax Accounts</h5> <!-- TODO: header necessary?-->
          </div>

          <div class="col-sm-12 col-md-12 col-lg-12 col-xl-12">
            <div class="form-group">
              <label for="constituentTaxAccounts">Tax account number(s): <span class="requiredField">*</span></label>
              <input type="text" name="constituentTaxAccounts" id="constituentTaxAccounts" class="form-control"  >
              <!-- TODO: form-text block necessary? -->
              <div class="form-text"><a href="https://sdat.dat.maryland.gov/RealProperty/Pages/default.aspx" target="_blank">Look up your tax account number</a></div>
            </div>
          </div>	
        </div>

        <!-- Property Address -->
        <div class="row">
          <div class="col-12">
            <h5>Property Address</h5>
          </div>
        </div>

        <div class="row">
          <div class="col-sm-12 col-md-6 col-lg-6 col-xl-6">
            <div class="form-group">
              <label for="constituentAddress1">Street Address: <span class="requiredField">*</span></label>
              <input type="text" name="constituentAddress1" id="constituentAddress1" class="form-control"  >
            </div>
          </div>

          <div class="col-sm-12 col-md-6 col-lg-6 col-xl-6">
            <div class="form-group">
              <label for="constituentAddress2">Address Line 2:</label>
              <input type="text" name="constituentAddress2" id="constituentAddress2" class="form-control" >
            </div>
          </div>
        </div>

        <div class="row">
          <div class="col-sm-4 col-md-4 col-lg-4 col-xl-4">
            <div class="form-group">
              <label for="ownerCity">City: <span class="requiredField">*</span></label>
              <input type="text" name="ownerCity" id="ownerCity" class="form-control"  >
            </div>
          </div>   
          
          <div class="col-sm-4 col-md-4 col-lg-4 col-xl-4">
            <div class="form-group">
              <label for="ownerState">State: <span class="requiredField">*</span></label>
              <input type="text" name="ownerState" id="ownerState" class="form-control"  >
            </div>
          </div>   

          <div class="col-sm-4 col-md-4 col-lg-4 col-xl-4">
            <div class="form-group">
              <label for="ownerZip">Zip Code: <span class="requiredField">*</span></label>
              <input type="text" name="ownerZip" id="ownerZip" class="form-control"  >
            </div>
          </div>
        </div>
      </div> <!-- end common beginning -->



      <!-- UNCOMMON MIDDLE -->
      <div id="uncommonMiddle">Options will be appended</div>



      <!-- COMMON ENDING -->
      <div id="commonEnding" class="common">

        <!-- Submit -->
        <div class="row">
          <div class="col-12">
            <div id="requiredHelpBlock" class="form-text">
              <p>Fields marked with <span class="requiredField">*</span> are required</p>
            </div>
          </div>
        </div>

        <div class="row">
          <div class="col-12">
            <button class="btn btn-primary" type="submit" id="submitButton" >Submit Form</button>
          </div>
        </div>
      </div> <!-- END COMMON ENDING -->

		</form>
  </div><!-- end form container-->
</div> <!-- end bootstrap-iso container -->
	
  
  <!-- Script imports -->
  <!-- jQuery (must come before Bootstrap & Popper.js) -->
  <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js"
    integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo"
    crossorigin="anonymous"></script>

  <!-- Popper.js (must come after jQuery, before Bootstrap js) -->
  <script src="https://cdn.jsdelivr.net/npm/popper.js@1.14.3/dist/umd/popper.min.js" 
    integrity="sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49" 
    crossorigin="anonymous"></script>

  <!-- Bootstrap js script -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.1.3/dist/js/bootstrap.min.js" 
    integrity="sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy" 
    crossorigin="anonymous"></script>
</body>




<!-- JavaScript -->
<script type="text/javascript">
  
  let selected = []; //user selection array
  const jsonData = {}; //json submit object
  let appealType1, appealType2, appealType3, appealType4, appealType5 = ""; //will contain uncommon form HTML markup
  let creditType1, creditType2 = ""; //will contain uncommon form HTML markup

  appealType1 = 
    '<div class="row">' +
      '<div class="col-12">' +
        '<h5>Appeal Basis: Property placed in wrong residental tier</h5>' +
      '</div>' +
    '</div>'

  appealType2 = 
    '<div class="row">' +
      '<div class="col-12">' +
        '<h5>Appeal Basis: Incorrect classification of	property</h5>' +
      '</div>' +
    '</div>'

  appealType3 = 
    '<div class="row">' +
      '<div class="col-12">' +
        '<h5>Appeal Basis: Homeowner\'s Association property where the fee cap is applicable but was not applied</h5>' +
      '</div>' +
    '</div>'

  appealType4 = 
    '<div class="row">' +
      '<div class="col-12">' +
        '<h5>Appeal Basis: Mathematical error or incorrect	impervious surface calculation</h5>' +
      '</div>' +
    '</div>'

  appealType5 = 
    '<div class="row">' +
      '<div class="col-12">' +
        '<h5>Appeal Basis: Exempt or incorrect property owner</h5>' +
      '</div>' +
    '</div>'


  function show() {
    for (var i = 1; i < selected.length; i++)
      $("#uncommonMiddle").append(selected[i]);
  }

  //show appeal or credit options
  document.querySelectorAll("#creditButton, #appealButton").forEach((applicationType) => {
  applicationType.addEventListener('click', function(event) {
    //complete reset selected array
    selected.length = 0;
    //add selected credit type to array
    selected.push(applicationType.name);
    $("#showError").html("You selected: " + selected);
    //show / hide      
    $("#" + selected[0]).show();

    $("#navigation").show();
    $("#applicationSelect").hide();

    console.log(JSON.stringify(selected));
  }); 
});


// //show selected credit form
//   document.querySelectorAll("#creditType1, #creditType2").forEach((creditType) => {
//     creditType.addEventListener('click', function(event) {
//       //truncate selected array to only include app type
//       selected.length = 1;
//       console.log(JSON.stringify(selected));
//       //add selected credit type to array
//       selected.push(creditType.id);
//       $("#showError").html("You selected: " + selected);
//       //show / hide      
//       $("." + selected[0]).show();

//       //$(selectedCreditType).show();
//       $("#applicationTypes, #creditTypes").hide();
//       $(".common, .creditApplication").show();
//       console.log(JSON.stringify(selected));
//     }); 
//   });

  function showCreditApplication(creditSelect) {
    $("#typeSelect").hide();
    $("#commonBeginning, #commonEnding").show();
    $("#uncommonMiddle").append(creditSelect);
  }


   /* Show appeal application */
   //change to a function to also be called by back button
  const continueButton = document.getElementById("continueButton");
  continueButton.addEventListener('click', (event) => {
  //function showAppealTypes() {
    console.log("call showAppealOptions()");
    // if validation is false, alert console
    if (validateCheckboxes(".appealTypes") == false)
      //alert("Please select at least one appeal type.");
      $("#showError").html("Please select at least one appeal type.");

    // if checkboxes pass validation,
    else
    {
      //show .common elements
      $(".common, .appealApplication").show();

      // display checked, hide unchecked (and add selected elements to array)
      showSelectedChecks();

      //hide menu options
      $(".appealTypes").hide();
    }  
    console.log("End showAppealOptions()");
  });

  //show associated classes of checked checkboxes, add selected to array
  function showSelectedChecks() {
    //store the appealTypes checkbox into a variable
    let appealCheckbox = document.querySelectorAll('input[name="appealCheckbox"]');
    //create an array to store the current appeal type IDs
    // OR change the div ids to classes that match
    let appealTypeIds = [];

    // for each checkbox element, push the id to the appealtype array
    appealCheckbox.forEach((checkbox) => {
      appealTypeIds.push(checkbox.id); //will be used to toggle divs
    });
    console.log(JSON.stringify(appealTypeIds));

    //trunmcate the contents of the selected array
    selected.length = 1;

    for (var i = 0; i < appealTypeIds.length; i++)
    {
      // if the id stored in the checkbox array is checked,
      if (document.getElementById(appealTypeIds[i]).checked) {
        // print to console, push value to selected array, show the associated .class divs
        console.log("\tChecked: " + appealTypeIds[i]);
        selected.push(appealTypeIds[i]);
        $("." + appealTypeIds[i]).show();
      }
      // if the id stored in the checkbox array is NOT checked,
      else if (!document.getElementById(appealTypeIds[i]).checked)
      {
        // print to console, hide the associated .class divs
        console.log("\tNot checked: " + appealTypeIds[i]);
        $("." + appealTypeIds[i]).hide();
      }

      // if neither o above option, print error to console          
      else 
        console.log("Error w appeal checkbox array");
    } 
    //print selected check options to console
    console.log("\tArray of selections inside method: " + JSON.stringify(selected));
    //print oprions to user (test)
    $("#showError").html("You selected: " + selected);
  }

  //determine if number of checked checkboxes in an element is > 0
  //@param the id of the element you want to check
  function validateCheckboxes(element) {
      console.log("call ValidateCheckBoxes")
      //Reference the CheckBoxes and determine Total Count of checked CheckBoxes.
      var numChecked = $(element + " input[type=checkbox]:checked").length;
        console.log("\tElement being validated: " + element);
        console.log("\tNumber checked: " + numChecked);

      console.log("\t" + numChecked + " checkboxes are checked.");

      if (numChecked > 0) {
          return true;
          console.log("\tTRUE")
      } else {
          console.log("\tFALSE")
          return false;
      }
  }




  
  // @Desc: Handle Form Submit
  const form = document.getElementById('dpwAppealCreditApplication');
  form.addEventListener('submit', (event) => {
    // event.preventDefault(); //lookup
    console.log(event);

    //json app type
    //do first, index[0] in seelcted array
    if (selected[0] == "appealTypes")
      jsonData.applicationType = "Appeal Application";
    else if (selected[0] == "creditTypes")
      jsonData.applicationType = "Credit Application";
    else
      jsonData.applicationType = $("error").val();

    //then, populate common json data
    jsonData.caseTypeId = $('').val
    jsonData.constituentFirstName = $('#constituentFirstName').val();
    jsonData.constituentLastName = $('#constituentLastName').val();
    jsonData.constituentAddress1 = $('#constituentAddress1').val();
    jsonData.constituentAddress1 = $('#constituentAddress1').val();
    jsonData.ownerCity = $('#ownerCity').val();
    jsonData.ownerState = $('#ownerState').val();
    jsonData.ownerZip = $('#ownerZip').val();

    //then, populate uncommon selections from array
    for (var i = 0; i < selected.length; i++)
      populateUncommonJson(selected[i]);

    console.log(JSON.stringify(jsonData));
  });

  
  //populate json based on user selection
  function populateUncommonJson(element) {
    console.log('populateUncommonJson()');

    switch (element) {
      case 'appealType1':
        jsonData.appealType1 = $('#appealType1').val();
        jsonData.a1TierCurrent = $('#a1TierCurrent').val();
        jsonData.a1TierProposed = $('#a1TierProposed').val();
        jsonData.a1Reason = $('#a1Reason').val();
        jsonData.a1Comments = $('#a1Comments').val();
        break;

      case 'creditType1':
        jsonData.creditType1 = $('#creditType2').val();
        jsonData.c1Description = $('#c1Description').val();
        break;

      case 'creditType2':
        jsonData.creditType1 = $('#creditType2').val();          
        jsonData.c2NPDESPermitNumber = $('#c2NPDESPermitNumber').val();
        jsonData.c2RegistrationNumber = $('#c2RegistrationNumber').val();
        break;

      default:
        console.log("Error: populate uncommon json default.")
    }
  }



  (function($) {
    $(document).ready(function() {

    // REDUCE THIS CODE
    //consider changing event listeners to functions that can be called for the back button as well
    //clean up classes / ids (use queryselector())


    // on click, determie what is currently displayed
      $("#backButton").click(function() {

        //when on a credit select page:
        if ($(".creditTypes").is(":visible")) {
          console.log("Leaving credit menu options")
          //showapplicationTypes();
          window.location.reload();
        }

        //when on an appeal select page:
        else if ($(".appealTypes").is(":visible")) {
          console.log("Leaving appeal menu options")
          //showApplicationTypes();
          window.location.reload();
        }

        //add more phases as you build the rest
        //when on an appeal application:
        else if ($(".appealApplication").is(":visible")) {
          console.log("Leaving appeal application")
          //showAppealTypes();
          window.location.reload();
        }

        //when on a credit application:
        else if ($(".creditApplication").is(":visible")) {
          console.log("Leaving credit application")
          //showCreditTypes();
          window.location.reload();
        }

        // if none is true, refresh page as fail-safe
        else {
          console.log("General page refresh.")
          window.location.reload();
        }
      });


    });
  })(jQuery);

</script>
</html>