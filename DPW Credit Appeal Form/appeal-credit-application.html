<!-- 
  Claire Dupree
 -->
<!doctype html>
<html lang="en">

<head>
	<meta charset="utf-8">

	<!-- REMOTE Bootstrap CSS -->
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.3.1/dist/css/bootstrap.min.css"
		integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
  <!---->
  
  <!-- LOCAL Bootstrap CSS -->
  <link rel="stylesheet" href="https://www.aacounty.org/_template-assets/css/bootstrap4-iso.min.css" />
  <!---->

	<!-- FontAwesome Icon Library -->
	<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.6.3/css/all.css"
		integrity="sha384-UHRtZLI+pbxtHCWp1t77Bi1L4ZtiqrqD80Kn4Z8NTSRyMA2Fd33n5dQ8lWUE00s/" crossorigin="anonymous">

  <title>Appeal / Credit Application</title>

  <!-- Embedded styles -->
	<style>
		.requiredField {
			color: red;
		}

    i {
      margin-right: 5px;
    }

    .row {
      /* using .form-group for padding */
      /* .row used for organization & responsiveness */
        padding: 0px !important;
        background: none !important;
        border-top: 0px !important;
        margin: auto !important;
    }
    
    .dropdown-menu {
      text-align: center !important;
    }
	</style>
</head>

<!-- TODO: 

  TODO: Tuesday 5/17

  delete vestigial element names, classes, variables and ids
  implement javascript doc comments

  add reportvalidity features

  create a function to prohibit same dropdown answers

    document upload - should issueflow accept a file or the base64 string?
    casemanager base names - get from tom
    testing JSON posting -good
  

  Step 1: find the hello world version of the thing youre trying to do
  Step 2: get the basic mechanism of it working
  Step 3: add complexity from there

-->




<body>
  <div class="bootstrap-iso">

  <!-- Back Button -->
  <div id="navigation" style="display: none">
    <div class="row">

      <!-- Error message box -->
      <!-- TODO: Replace with a custom reportValidity(); -->
      <!-- https://stackoverflow.com/questions/56406865/how-do-i-trigger-html5-validation-error-popup-when-custom-validation-message-is -->
      <div class="col-8 form-group">
        <p id="showError" class="requiredField" style="text-align: center">Text should be replaced by an error message</p>
      </div>

      <!-- Go Back button -->
      <div id="backButton" class="col-4 form-group">
        <button class="btn btn-light btn-block">Go Back</button>
      </div>
    </div>
  </div>  
  


  <!-- SELECT APPLICATION TYPE -->
  <div id="applicationSelect">

    <div class="row applicationSelect">
      <div class="col-6">
        <button class="btn btn-dark btn-block" name="appeal" id="appealButton" onclick="showApplicationTypes('appeal')">
          <i class='far fa-comment'></i>Appeal</button>
      </div>
      
      <div class="col-6 applicationSelect">
        <button class="btn btn-dark btn-block" name="credit" id="creditButton"onclick="showApplicationTypes('credit')">
          <i class='fas fa-edit'></i>Credit</button>
      </div>
    </div>  
  </div>



  <!-- SELECT APPEAL or CREDIT TYPE -->
  <div id="typeSelect">

    <!-- Select Appeal Type(s) -->
    <div id="appeal" style="display: none">
      <div class="row">
        <div id="appealChecks" class="col-12 form-group">
          <h5>Select the reason(s) for the appeal:</h5>

          <div class="form-check">
            <input class="form-check-input" type="checkbox" id="appealType1" name="appealCheckbox" 
              value="Property placed in wrong residential tier">
            <label class="form-check-label" for="appealType1">Property placed in wrong residential tier</label>
          </div>

          <div class="form-check">
            <input class="form-check-input" type="checkbox" id="appealType2" name="appealCheckbox" 
              value="Incorrect classification of property">
            <label class="form-check-label" for="appealType2">Incorrect classification of property</label>
          </div>

          <div class="form-check">
            <input class="form-check-input" type="checkbox" id="appealType3" name="appealCheckbox" value="Homeowner's Association property 
              where the fee cap is applicable but was not applied">
            <label class="form-check-label" for="appealType3">Homeowner's Association property where the fee cap is applicable but was not applied</label>
          </div>

          <div class="form-check">
            <input class="form-check-input" type="checkbox" id="appealType4" name="appealCheckbox" 
              value="Mathematical error or incorrect impervious surface calculation">
            <label class="form-check-label" for="appealType4">Mathematical error or incorrect impervious surface calculation</label>
          </div>

          <div class="form-check">
            <input class="form-check-input" type="checkbox" id="appealType5" name="appealCheckbox" 
              value="Exempt or incorrect property owner">
            <label class="form-check-label" for="appealType5">Exempt or incorrect property owner</label>
          </div>
        </div> 
      </div>

      <!-- Continue button -->
      <div class="row">
        <div class="col-12 text-center form-group">
          <!-- onclick: validates checkboxes, resets selections, appends new selections -->
          <button type="button" class="btn btn-primary" id="continueButton" onclick="showAppealApplication()">Continue</button>
        </div>
      </div>
    </div>


    <!-- Select Credit Type -->
    <div id="credit" style="display: none">
      <div class="row">
        <div class="col-12 form-group">
          <h5>Select the credit type:</h5>
          <button class="btn btn-light btn-block" value="Property not under an NPDES permit" 
            id="creditType1" onclick="showCreditApplication('creditType1')">Property not under an NPDES	permit</button>
          <button class="btn btn-light btn-block" value="Property with an NPDES permit that includes stormwater management controls" 
            id="creditType2" onclick="showCreditApplication('creditType2')">Property with an NPDES permit that includes	stormwater management controls</button>
        </div>
      </div>
    </div>

  </div> <!-- end type select -->



  <!-- FORM CONTAINER -->
	<div id="formContainer" style="display: none"> <!-- style="display: none-->

    <!-- Header -->
    <div id="formHeader" class="uncommon">
      <!-- to be apended -->
    </div>

    <!-- Form -->
    <form id="wprfApplication" class="form">

      <!-- COMMON BEGINNING -->
      <div id="commonBeginning">

        <!-- Owner Information -->
        <div class="row">
          <div class="col-12">
            <h5>Property Owner Information</h5>
          </div>
        </div>

        <div class="row">
          <div class="col-sm-12 col-md-6 col-lg-6 col-xl-6">
            <div class="form-group">
              <label for="ownerFirstName">Owner First Name: <span class="requiredField">*</span></label>
              <input type="text"  name="ownerFirstName" id="ownerFirstName" class="form-control" required>
            </div>
          </div>

          <div class="col-sm-12 col-md-6 col-lg-6 col-xl-6">
            <div class="form-group">
              <label for="ownerLastName">Owner Last Name: <span class="requiredField">*</span></label>
              <input type="text" name="ownerLastName" id="ownerLastName" class="form-control" required>
            </div>
          </div>
        </div>

        <div class="row">  
          <div class="col-12">
            <div class="form-group">
              <label for="ownerOrganization">Owner Company / Organization (if applicable)</label>
              <input type="text" name="ownerOrganization" id="ownerOrganization" class="form-control">
            </div>
          </div>
        </div>

        <!-- Tax Account(s) -->
        <div class="row">
          <div class="col-12">
            <h5>Tax Accounts</h5>
          </div>

          <div class="col-sm-12 col-md-12 col-lg-12 col-xl-12">
            <div class="form-group">
              <label for="ownerTaxAccounts">Tax account number(s): <span class="requiredField">*</span></label>
              <input type="text" name="ownerTaxAccounts" id="ownerTaxAccounts" class="form-control" required>
              <!-- TODO: form-text block necessary? -->
              <div class="form-text"><a href="https://sdat.dat.maryland.gov/RealProperty/Pages/default.aspx" target="_blank">Look up your tax account number</a></div>
            </div>
          </div>	
        </div>

        <!-- Property Address -->
        <div class="row">
          <div class="col-12">
            <h5>Property Address</h5>
          </div>
        </div>

        <div class="row">
          <div class="col-sm-12 col-md-6 col-lg-6 col-xl-6">
            <div class="form-group">
              <label for="propertyAddress1">Street Address: <span class="requiredField">*</span></label>
              <input type="text" name="propertyAddress1" id="propertyAddress1" class="form-control" required>
            </div>
          </div>

          <div class="col-sm-12 col-md-6 col-lg-6 col-xl-6">
            <div class="form-group">
              <label for="propertyAddress2">Address Line 2:</label>
              <input type="text" name="propertyAddress2" id="propertyAddress2" class="form-control">
            </div>
          </div>
        </div>

        <div class="row">
          <div class="col-sm-12 col-md-4 col-lg-4 col-xl-4">
            <div class="form-group">
              <label for="propertyCity">City: <span class="requiredField">*</span></label>
              <input type="text" name="propertyCity" id="propertyCity" class="form-control" required>
            </div>
          </div>   
          
          <div class="col-sm-12 col-md-4 col-lg-4 col-xl-4">
            <div class="form-group">
              <label for="propertyState">State: <span class="requiredField">*</span></label>
              <input type="text" name="propertyState" id="propertyState" class="form-control" required>
            </div>
          </div>   

          <div class="col-sm-12 col-md-4 col-lg-4 col-xl-4">
            <div class="form-group">
              <label for="propertyZip">Zip Code: <span class="requiredField">*</span></label>
              <input type="text" name="propertyZip" id="propertyZip" class="form-control" required>
            </div>
          </div>
        </div>

        <!-- Contact Information -->
        <div class="row">
          <div class="col-12">
            <h5>Contact Information</h5>
          </div>
        </div>  

        <div class="row">
          <div class="col-12">
            <div class="form-group">
              Is applicant a person other than the property owner? <span class="requiredField">*</span><br>
              <div class="form-check form-check-inline">
                <input class="form-check-input" type="radio" id="representativeYes" name="applicantRepresentative" 
                  value="yes" onchange="representativeToggle()" required>
                <label class="form-check-label" for="representativeYes">Yes</label>
              </div>
              
              <div class="form-check form-check-inline">
                <input class="form-check-input" type="radio" id="representativeNo" name="applicantRepresentative" 
                  value="no" onchange="representativeToggle()" required>
                <label class="form-check-label" for="representativeNo">No</label>
              </div>
            </div>
          </div>
        </div>

        <div id="representative" class="uncommon">
          <!-- append only if "representativeYes: checked" -->
        </div>

        <div class="row">
          <div class="col-sm-12 col-md-6 col-lg-6 col-xl-6">
            <div class="form-group">
              <label for="constituentPhone">Phone Number <span class="requiredField">*</span></label>
              <input type="text" id="constituentPhone" name="constituentPhone" class="form-control" required>
            </div>
          </div>

          <div class="col-sm-12 col-md-6 col-lg-6 col-xl-6">
            <div class="form-group">
              <label for="constituentEmail">Email Address <span class="requiredField">*</span></label>
              <input type="email" id="constituentEmail" name="constituentEmail" class="form-control" required>
            </div>
          </div>
        </div>


        <div class="row">
          <div class="col-12">
            <h5>Mailing Address</h5>
          </div>
        </div>  

        <div class="row">
          <div class="col-12">
            <div class="form-group">
              Is the mailing address different than the property address? <span class="requiredField">*</span><br>
              <div class="form-check form-check-inline">
                <input class="form-check-input" type="radio" id="mailingDifferentYes" name="mailingDifferent" 
                  value="yes" onchange="mailingAddressToggle()" required>
                <label class="form-check-label" for="mailingDifferentYes">Yes</label>
              </div>
              
              <div class="form-check form-check-inline">
                <input class="form-check-input" type="radio" id="mailingDifferentNo" name="mailingDifferent" 
                  value="no" onchange="mailingAddressToggle()" required>
                <label class="form-check-label" for="mailingDifferentNo">No</label>
              </div>
            </div>
          </div>
        </div>

        <div id="mailingAddress" class="uncommon">
          <!-- append only if "mailingDifferentYes: checked" -->
        </div>
      </div> <!-- End common beginning -->


      <!-- UNCOMMON MIDDLE -->
      <div id="uncommonMiddle" class="uncommon">
        <!-- to be appended w/ selected appeal or credit type(s) -->
      </div>


      <!-- COMMON ENDING -->
      <div id="commonEnding">

        <!-- jsonData.supportingDoc = ''; --> 
        <div class="row">
          <div class="col-12">
            <h5>Supporting Documentation</h5>
          </div>
        </div> 

        <!-- file upload -->
        <div class="col-12">
          <div class="form-group">
            <input
              style="display:none"
              type="file"
              class="form-control file-upload-input"
              id="piaAttachments"
              name="piaAttachments[]"
              multiple
              accept="image/*,.pdf,.xml,.xlsx,.doc,.docx,application/msword,application/vnd.openxmlformats-officedocument.wordprocessingml.document"
            />
            <button type="button" class="file-upload-btn btn btn-secondary">Choose Files</button>
            <span style="margin-left: 10px" class="file-upload-label"></span>
          </div>
        </div>
        <!-- file upload -->
      <!-- file upload
      <div class="row">
        <div class="col-12">
          <div class="form-group">
            <input
              type="file" class="form-control-file file-upload-input" 
              id="supportingDocuments" name="supportingDocuments" multiple
              accept="image/*,.pdf,.xml,.xlsx,.doc,.docx,application/msword,application/vnd.openxmlformats-officedocument.wordprocessingml.document"/>
            
            <button type="button" class="file-upload-btn btn btn-secondary">Choose File(s)</button>
            <span class="file-upload-label"></span>
          </div>
        </div>
      </div>
    -->
        <!-- <div class="row">
          <div class="col-12">
            <div class="form-group">
              <!-- <label for="supportingDoc">Supporting Documentation</label> --
              <input class="form-control-file" type="file" id="supportingDoc" 
                name="fileUploadButton" multiple>
            </div>
          </div>
        </div> -->
        

        <div id="statement" class="uncommon">
          <!-- to be appended w/ appeal acknowledgement or credit authorization  -->
        </div>


        <div class="row">
          <div class="col-sm-12 col-md-6 col-lg-6 col-xl-6">
            <div class="form-group">
              <label for="signaturePrinted">Printed Signature <span class="requiredField">*</span></label>
              <input type="text" id="signaturePrinted" name="signaturePrinted" class="form-control" required>
            </div>
          </div>

          <div class="col-sm-12 col-md-6 col-lg-6 col-xl-6">
            <div class="form-group">
              <label for="signatureTitle">Title (if applicable)</label>
              <input type="text" name="signatureTitle" id="signatureTitle" class="form-control">
            </div>
          </div>
        </div>

        <div class="row">  
          <div class="col-12">
            <div class="form-group">
              <label for="signatureOrganization">Company / Organization (if applicable)</label>
              <input type="text" name="signatureOrganization" id="signatureOrganization" class="form-control">
            </div>
          </div>
        </div>


        <!-- Submit -->
        <div class="row">
          <div class="col-12">
            <div id="requiredHelpBlock" class="form-text">
              <p>Fields marked with <span class="requiredField">*</span> are required</p>
            </div>
          </div>
        </div>

        <div class="row">
          <div class="col-12">
            <button class="btn btn-primary" type="submit" id="submitButton" >Submit Form</button>
          </div>
        </div>
      </div> <!-- End common ending -->

		</form>
  </div><!-- End form container -->



<!-- UNCOMMON DIVS -->
<!-- To be appended based on selection -->
<div id="uncommonForms" style="display: none">

  <div id="representativeForm">
    <div class="row">
      <div class="col-sm-12 col-md-6 col-lg-6 col-xl-6">
        <div class="form-group">
          <label for="applicantFirstName">Applicant First Name: <span class="requiredField">*</span></label>
          <input type="text"  name="applicantFirstName" id="applicantFirstName" class="form-control" required>
        </div>
      </div>

      <div class="col-sm-12 col-md-6 col-lg-6 col-xl-6">
        <div class="form-group">
          <label for="applicantLastName">Applicant Last Name: <span class="requiredField">*</span></label>
          <input type="text" name="applicantLastName" id="applicantLastName" class="form-control" required>
        </div>
      </div>
    </div>

    <div class="row">  
      <div class="col-12">
        <div class="form-group">
          <label for="applicantOrganization">Applicant Company / Organization (if applicable)</label>
          <input type="text" name="applicantOrganization" id="applicantOrganization" class="form-control">
        </div>
      </div>
    </div>
  </div>

  <div id="mailingAddressForm">
    <div class="row">
      <div class="col-sm-12 col-md-6 col-lg-6 col-xl-6">
        <div class="form-group">
          <label for="constituentAddress1">Street Address: <span class="requiredField">*</span></label>
          <input type="text" name="constituentAddress1" id="constituentAddress1" class="form-control" required>
        </div>
      </div>

      <div class="col-sm-12 col-md-6 col-lg-6 col-xl-6">
        <div class="form-group">
          <label for="constituentAddress2">Address Line 2:</label>
          <input type="text" name="constituentAddress2" id="constituentAddress2" class="form-control">
        </div>
      </div>
    </div>

    <div class="row">
      <div class="col-sm-12 col-md-4 col-lg-4 col-xl-4">
        <div class="form-group">
          <label for="constituentCity">City: <span class="requiredField">*</span></label>
          <input type="text" name="constituentCity" id="constituentCity" class="form-control" required>
        </div>
      </div>   
      
      <div class="col-sm-12 col-md-4 col-lg-4 col-xl-4">
        <div class="form-group">
          <label for="constituentState">State: <span class="requiredField">*</span></label>
          <input type="text" name="constituentState" id="constituentState" class="form-control" required>
        </div>
      </div>   

      <div class="col-sm-12 col-md-4 col-lg-4 col-xl-4">
        <div class="form-group">
          <label for="constituentZip">Zip Code: <span class="requiredField">*</span></label>
          <input type="text" name="constituentZip" id="constituentZip" class="form-control" required>
        </div>
      </div>
    </div>
  </div>


  <!-- Headers -->
  <div id="appealHeader">
    <div class="row">
      <div class="col-12">
        <h4>Stormwater Fee Appeal Application</h4> 
      </div>
    </div>
  </div>

  <div id="creditHeader">
    <div class="row">
      <div class="col-12">
        <h4>Stormwater Credit Application</h4>
      </div>
    </div>
  </div>


  <!-- APPEAL APPLICATIONS -->
  <!-- Appeal Type 1: Property places in wrong residential tier -->
  <div id="appeal1Form">
    <div class="row">
      <div class="col-12">
        <h5>Appeal Basis 1: Property placed in wrong residental tier</h5>
      </div>
    </div>

    <!-- Residental Property Tier info -->
    <div class="form-group">
      <div class="row">
        <div class="col-12">
          <div style="background-color: #f0f0f0; padding: 10px">
            <b><i class="fas fa-info-circle" style="color: #0072bc; margin-right: 5px"></i>List of Residential Tiers</b>
            <ul style="margin-left: 20px">
              <li>WPRF01 / Tier 1: Residential property with a detached single family dwelling in Rural Agricultural (RA) or
                Residential Low Density (RLD) zoning</li>
              <li>WPRF02 / Tier 2: Residential property with a detached single family dwelling in R1, R2, or R5 residential
                zoning</li>
              <li>WPRF03 / Tier 3: Residential property in R10 or R15 residential zoning or an attached dwelling in RA, 
                RLD, R1, R2, or R5 zoning
              </li>
            </ul>
          </div>
        </div>
      </div>
    </div>
    
    <div class="form-group">
      <div class="row">
        <div class="col-12">
          On the property tax bill, <br>
          <div class="form-select">
            <label for="a1TierCurrent">The property is currently classified as: 
              <span class="requiredField">*</span></label>
            <select class="form-select" name="a1TierCurrent" id="a1TierCurrent" aria-label="a1TierCurrent" required>
              <option selected value="">Please select</option>
              <option name="a1Test" value="WPRF01">WPRF01: Tier 1 Residential</option>
              <option name="a1Test" value="WPRF02">WPRF02: Tier 2 Residential</option>
              <option name="a1Test" value="WPRF03">WPRF03: Tier 3 Residential</option>
            </select>
          </div>
        </div>

        <div class="col-12">
          <div class="form-select">
            <label for="a1TierProposed">The property should be classified as: 
              <span class="requiredField">*</span></label>
              <!-- TODO: onchange: cannot be the same as a1TierCurrent -->
            <select class="form-select" name="a1TierProposed" id="a1TierProposed" aria-label="a1TierProposed" required>
              <option selected value="">Please select</option>
              <option name="a1Test" value="WPRF01">WPRF01: Tier 1 Residential</option>
              <option name="a1Test" value="WPRF02">WPRF02: Tier 2 Residential</option>
              <option name="a1Test" value="WPRF03">WPRF03: Tier 3 Residential</option>
            </select>
          </div>
        </div>
      </div>
    </div>

    <div class="row">
      <div class="col-12">
        <div class="form-group">
          Reason: <span class="requiredField">*</span><br>
          <div class="form-check">
            <input class="form-check-input" type="radio" id="a1Reason1" name="a1Reason" 
              value="The property's tier is incorrect based on its zoning" required>
            <label class="form-check-label" for="a1Reason1">The property's tier is incorrect based on its zoning</label>
          </div>

          <div class="form-check">
            <input class="form-check-input" type="radio" id="a1Reason2" name="a1Reason" 
              value="The property is an attached dwelling in residential zoning but is not categorized as Tier 3" required>
            <label class="form-check-label" for="a1Reason2">The property is an attached dwelling in residential zoning but is not 
                categorized as Tier 3</label>
          </div>

          <div class="form-check">
            <input class="form-check-input" type="radio" id="a1Reason3" name="a1Reason" 
              value="The property should be classified as the next lower tier due to the amount of impervious surface on site" required>
            <label class="form-check-label" for="a1Reason3">The property should be classified as the next lower tier due to the 
                amount of impervious surface on site (Less than 2,900 sq ft for a Tier 1 property; 
                Less than 1,200 sq ft for a Tier 2 property)</label>
          </div>
        </div>
      </div>
    </div>

    <!-- TODO: include this in the radio button form-group row? -->
    <div class="row">
      <div class="col-12">
        <div class="form-group">
          <div id="a1ReasonHelpBlock" class="form-text">Use the <a href="www.aacounty.org/myannearundel" target="_blank">
            My Anne Arundel application</a> to look up information on the stormwater fee, impervious amounts, and property zoning. 
          </div>
        </div>
      </div>
    </div>

    <div class="row">
      <div class="col-12">
        <div class="form-group">
          <label for="a1Comments">Comments: </label>
          <textarea class="form-control" id="a1Comments" rows="3"></textarea>
        </div>
      </div>
    </div>
  </div> <!-- End appeal 1 application -->


  <!-- Appeal Type 1: Incorrect classification of	property -->
  <div id="appeal2Form">
    <div class="row">
      <div class="col-12">
        <h5>Appeal Basis 2: Incorrect classification of	property</h5>
      </div>
    </div>
  </div> <!-- End appeal 2 application -->


  <!-- Appeal Type 3: Homeowner's Association property where the fee cap is applicable but was not applied -->
  <div id="appeal3Form">
    <div class="row">
      <div class="col-12">
        <h5>Appeal Basis 3: Homeowner's Association property where the fee cap is 
          applicable but was not applied</h5>
      </div>
    </div>
  </div> <!-- End appeal 3 application -->


  <!-- Appeal Type 4: Mathematical error or incorrect	impervious surface calculation -->
  <div id="appeal4Form">
    <div class="row">
      <div class="col-12">
        <h5>Appeal Basis 4: Mathematical error or incorrect	impervious surface calculation</h5>
      </div>
    </div>
  </div> <!-- End appeal 4 application -->


  <!-- Appeal Type 5: Exempt or incorrect property owner -->  
  <div id="appeal5Form">
    <div class="row">
      <div class="col-12">
        <h5>Appeal Basis 5: Exempt or incorrect property owner</h5>
      </div>
    </div>
  </div> <!-- End appeal 5 application -->


  <!-- CREDIT APPLICATIONS -->
  <!-- Credit Type 1: Property not under an NPDES permit -->
  <div id="credit1Form">
    <div class="row">
      <div class="col-12">
        <h5>Credit Type 1: Property not under an NPDES permit</h5>
      </div>
    </div>

    <div class="row form-group">
      <div class="col-12">
        <div class="form-group">
          <label for="c1Description">Briefly describe the stormwater practices on the property (type, quantity, location): <span class="requiredField">*</span></label>
          <textarea class="form-control" id="c1Description" rows="3" required></textarea>
        </div>
      </div>
    </div>
  </div>


  <!-- Credit Type 2: Property with an NPDES permit that includes stormwater management controls -->
  <div id="credit2Form">
    <div class="row">
      <div class="col-12">
        <h5>Credit Type 2: Property with an NPDES permit that includes stormwater management controls</h5>
      </div>
    </div> 

    <div class="row">
      <div class="col-sm-12 col-md-6 col-lg-6 col-xl-6">
        <div class="form-group">
          <label for="c2NPDESPermitNumber">NPDES Permit Number: <span class="requiredField">*</span></label>
          <input type="text" id="c2NPDESPermitNumber" class="form-control" required>
        </div>
      </div>

      <div class="col-sm-12 col-md-6 col-lg-6 col-xl-6">
        <div class="form-group">
          <label for="c2RegistrationNumber">MDE Facility Registration Number: <span class="requiredField">*</span></label>
          <input type="text" id="c2RegistrationNumber" class="form-control" required>
        </div>
      </div>
    </div>
  </div>


  <!-- Statement Authentication -->
  <div id="appealAcknowledgement">
    <div class="row">
      <div class="col-12">
        <h5>Acknowledgement</h5>
      </div>
    </div> 

    <div class="form-group">
      <div class="col-12">
        I/we, the undersigned do hereby declare under the penalties of perjury that the information 
        provided on and with this application is, to the best of my/our knowledge and belief, true, correct, 
        and complete.  I/we also understand that the failure to provide all information and/or documentation 
        as required is a basis for a denial of the appeal. I/we understand that by filing this appeal, we are 
        authorizing the Department of Public Works to confirm the information provided with this application, 
        including, but not limited to, inspecting and entering the property to verify the amount of impervious 
        surface area. I/we understand that if the Department of Public Works grants the appeal and it results 
        in a change in the stormwater remediation fee, I/we will be issued a new bill.  I/we understand that if 
        I/we are aggrieved by the decision of the Department of Public Works, I/we shall pay the stormwater 
        remediation fee, may request a refund and if a refund is denied, may appeal to the Maryland Tax Court 
        in accordance with Article 24, § 9-710 and 9-712 of the Annotated Code of Maryland. 
      </div>

      <div class="row">
        <div class="col-12">
          <div class="form-check form-check-inline">
            <input class="form-check-input" type="radio" id="statementAppeal" name="statementAppeal" value="acknowledged" required>
            <label class="form-check-label" for="statementAppeal">I acknowledge <span class="requiredField">*</span></label>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div id="creditAuthorization">
    <div class="row">
      <div class="col-12">
        <h5>Authorization</h5>
      </div>
    </div> 

    <div class="form-group">
      <div class="col-12">
        By signing this form, you certify that (1) you have read and understand the Stormwater 
        Remediation Credit Policy and Guidance requirements; (2) the information provided on this 
        form is complete and factual; (3) the stormwater management system(s) on your property 
        have been maintained and are in proper working order; and (4) you grant the County 
        permission to conduct site inspections of the stormwater management practices 
        included as part of this application package.
      </div>

      <div class="row">
        <div class="col-12">
          <div class="form-check form-check-inline">
            <input class="form-check-input" type="radio" id="statementCredit" name="statementCredit" value="authorized" required>
            <label class="form-check-label" for="statementCredit">I authorize <span class="requiredField">*</span></label>
          </div>
        </div>
      </div>
    </div>
  </div>

</div> <!-- End "display: none" uncommon divs-->

  
</div> <!-- end bootstrap-iso container -->
	
  

  <!-- Script imports -->
  <!-- jQuery (must come before Bootstrap & Popper.js) -->
  <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js"
    integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo"
    crossorigin="anonymous"></script>

  <!-- Popper.js (must come after jQuery, before Bootstrap js) -->
  <script src="https://cdn.jsdelivr.net/npm/popper.js@1.14.3/dist/umd/popper.min.js" 
    integrity="sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49" 
    crossorigin="anonymous"></script>

  <!-- Bootstrap js script -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.1.3/dist/js/bootstrap.min.js" 
    integrity="sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy" 
    crossorigin="anonymous"></script>
  
  <!-- Axios -->
  <script src="https://unpkg.com/axios/dist/axios.min.js"></script>

</body>



<!-- JavaScript -->
<script type="text/javascript">
  
  const form = document.getElementById('wprfApplication');
  let selected = []; //user selection array
  const jsonData = {}; //json submit object
  //case manager object
  const cmObject = {
    caseTypeUUID: '6d788088-0501-4db3-82b2-9a72bf61820f',
    jsonData: jsonData,
  };
  let fileUploads = []; //copied from pia form
  let attachment = []; //copied from pia form
    

  // TESTING PREVENTING DUPLICATE DROPDOWNS
  function duplicates() {
    if ($('#a1TierCurrent').val() == $('#a1TierProposed').val()) {
      console.log('duplicates true')
      return true;
    }
    else {
      console.log('duplicates false')
      return false;
    }
  }

  // combine utility functions later
  // const representative = document.getElementsByName("applicantRepresentative");
  // representative.addEventListener('change', (event) => {
  // });
  function mailingAddressToggle() {
    if (document.getElementById("mailingDifferentYes").checked) {
      console.log('yes');
      // TODO: this doesnt reset when form is reset
      $("#mailingAddress").html($("#mailingAddressForm").html());
    }
    else {
      console.log('no');
      $("#mailingAddress").html("");
    }
  }

    
  // combine utility functions later
  function representativeToggle() {
    if (document.getElementById("representativeYes").checked) {
      console.log('yes');
      $("#representative").html($("#representativeForm").html());
    }
    else {
      console.log('no');
      $("#representative").html("");
    }
  }

  // BACK BUTTON 
  $("#backButton").click(function() {
    if ($("#appeal").is(":visible") || $("#credit").is(":visible")) {
      console.log("Leaving application type select")
      $("#navigation, #appeal, #credit").hide();
      $("#applicationSelect").show();      
    }
    else if ($("#formContainer").is(":visible")) {
      console.log("Leaving application")
      $("#" + selected[0]).show();  
      console.log('reset middle div');
      $("#formContainer").hide();      
    }
    else {
      console.log("Back button default - page refresh")
      window.location.reload(); //default
    }
  });


  // SHOW APPLICATION TYPE
  function showApplicationTypes(applicationType) {
    // reset array, appeal checkboxes, form input, uncommon divs
    selected.length = 0;
    $('input[type=checkbox]').prop('checked', false);
    document.getElementById('wprfApplication').reset();
    //$(".uncommon").html("");

    //add choice to array
    selected.push(applicationType);
    $("#showError").html("You selected: " + selected); //display temp console

    //show application
    $("#" + selected[0]).show();
    //hide initial options
    $("#navigation").show();
    $("#applicationSelect").hide();

    // Print selections so far
    console.log(JSON.stringify(selected));
  }


  // SHOW CREDIT APPLICATION
  function showCreditApplication(creditType) {
    selected.length = 1; //truncate array
    $(".uncommon").html(""); //reset uncomon divs

    $("#formHeader").html($("#creditHeader").html()); //set credit header
    $("#statement").html($("#creditAuthorization").html()); //set credit auth statement

    // set uncommon credit options
    console.log("Populate array data & append middle div");
    switch (creditType) {
      case "creditType1":
        $("#uncommonMiddle").html($("#credit1Form").html());
        selected.push(creditType);
        break;
      case "creditType2":
        $("#uncommonMiddle").html($("#credit2Form").html());
        selected.push(creditType);
        break;
      default:
        $("#showError").html("Error appending credit types");
    }   

    $("#credit").hide(); //hide credit select  
    $("#formContainer").show(); //show form

    console.log(JSON.stringify(selected));
    $("#showError").html("You selected: " + selected); //temporary
  }



  // SHOW APPEAL APPLICATION
  function showAppealApplication() {
    console.log("Validate checkboxes");
    if (validateCheckboxes("#appeal") == false)
      $("#showError").html("Please select at least one appeal type.");

    else {
      selected.length = 1; //truncate array
      $(".uncommon").html(""); //reset uncomon divs

      $("#formHeader").html($("#appealHeader").html()); //set appeal header
      $("#statement").html($("#appealAcknowledgement").html()); //set appeal ack statement

      populateSelectedAppealTypes(); //populate selected array

      // set uncommon appeal options
      for (var i = 1; i < selected.length; i++) {
        console.log("Appending matching appeal types");
        switch (selected[i]) {
          case "appealType1":
            $("#uncommonMiddle").append($("#appeal1Form").html());
            break;
          case "appealType2":
            $("#uncommonMiddle").append($("#appeal2Form").html());
            break;
          case "appealType3":
            $("#uncommonMiddle").append($("#appeal3Form").html());
            break;
          case "appealType4":
            $("#uncommonMiddle").append($("#appeal4Form").html());
            break;
          case "appealType5":
            $("#uncommonMiddle").append($("#appeal5Form").html());
            break;
          default:
            $("#showError").html("Error appending appeal types.");
        }   
      }

      console.log("Show appeal application");
      $("#appeal").hide(); //hide appeal select  
      $("#formContainer").show(); //show form

      console.log(JSON.stringify(selected));
      $("#showError").html("You selected: " + selected); //temporary
    }  
  }


  // Validate checked checkboxes is > 0
  //@param The element id to be checked (can be used for other form checkboxes)
  function validateCheckboxes(element) {
    // Reference the checked checkboxes of the element
    var numChecked = $(element + " input[type=checkbox]:checked").length;
    console.log("\t" + numChecked + " checkboxes are checked");

    if (numChecked > 0) {
      return true;
    } 
    else {
      return false;
    }
  }


  // Populate array selection data in the selected array
  function populateSelectedAppealTypes() {
    // Create a local array of appeal ids
    let appealCheckbox = document.querySelectorAll('input[name="appealCheckbox"]'); 
    let appealOptions = [];
    appealCheckbox.forEach((checkbox) => {
      appealOptions.push(checkbox.id); 
    });

    // If checked, add to array
    for (var i = 0; i < appealOptions.length; i++) {
      if (document.getElementById(appealOptions[i]).checked) {
        console.log("\tChecked: " + appealOptions[i]);
        selected.push(appealOptions[i]);
      }
    } 
  }

  // Copied from pia form
  //@Desc: Handle file upload
  Array.prototype.forEach.call(document.querySelectorAll('.file-upload-btn'), (button) => {
    const hiddenInput = button.parentElement.querySelector('.file-upload-input');
    const label = button.parentElement.querySelector('.file-upload-label');
    const defaultLabelText = 'No files chosen';
    label.textContent = defaultLabelText;
    label.title = defaultLabelText;

    button.addEventListener('click', () => {
      hiddenInput.click();
    });
    hiddenInput.addEventListener('change', () => {
      fileUploads = [];
      let fileNameList = '';
      fileNameList = Array.prototype.map.call(hiddenInput.files, (file) => {
        fileUploads.push(file);
        return file.name;
      });

      base64Ready();
      label.textContent = fileNameList.join(', ') || defaultLabelText;
      label.title = label.textContent;
    });
  });

  //@Desc: convert to base64
  const toBase64 = (file) => {
    return new Promise((resolve, reject) => {
      const reader = new FileReader();
      reader.readAsDataURL(file);
      reader.onload = () => resolve(reader.result);
      reader.onerror = (error) => reject(error);
    });
  };

  //@Desc: build base64 obj
  const base64Ready = () => {
    fileUploads.forEach(async (element) => {
      let getBase64 = await toBase64(element);
      let base64 = getBase64.split(',')[1];
      attachment.push({ filename: element.name, base64: base64 });
    });
  };


  // TODO format comments to match jsdoc
  // @Desc: Handle Form Submit
  form.addEventListener('submit', (event) => {
      event.preventDefault(); //preventing page refresh?
      console.log(event);
    if (duplicates() == true) {
      return;
    }
    else {

      // TODO: reorder these so constituent is first?
      jsonData.ownerFirstName = $('#ownerFirstName').val();
      jsonData.ownerLastName = $('#ownerLastName').val();
      jsonData.ownerOrganization = $('#ownerOrganization').val();
      jsonData.ownerTaxAccounts = $('#ownerTaxAccounts').val();
      jsonData.propertyAddress1 = $('#propertyAddress1').val();
      jsonData.propertyAddress2 = $('#propertyAddress2').val();
      jsonData.propertyCity = $('#propertyCity').val();
      jsonData.propertyState = $('#propertyState').val();
      jsonData.propertyZip = $('#propertyZip').val();
      jsonData.applicantRepresentative = $('input[name="applicantRepresentative"]:checked').val(); //yes or no
      if (jsonData.applicantRepresentative == 'no') {
          jsonData.constituentFirstName = jsonData.ownerFirstName;
          jsonData.constituentLastName = jsonData.ownerLastName;
          jsonData.constituentOrganization = jsonData.ownerOrganization;
      }
      else if (jsonData.applicantRepresentative == 'yes') {
          jsonData.constituentFirstName = $('#applicantFirstName').val();
          jsonData.constituentLastName = $('#applicantLastName').val();
          jsonData.constituentOrganization = $('#applicantOrganization').val();
      }
      jsonData.constituentPhone = $('#constituentPhone').val();
      jsonData.constituentEmail = $('#constituentEmail').val();
      jsonData.mailingDifferent = $('input[name="mailingDifferent"]:checked').val(); //yes or no
      if (jsonData.mailingDifferent == 'no') {
          jsonData.constituentAddress1 = jsonData.propertyAddress1;
          jsonData.constituentAddress2 = jsonData.propertyAddress2;
          jsonData.constituentCity = jsonData.propertyCity;
          jsonData.constituentState = jsonData.propertyState;
          jsonData.constituentZip = jsonData.propertyZip;
        }  
      else if (jsonData.mailingDifferent == 'yes') {
          jsonData.constituentAddress1 = $('#constituentAddress1').val(); //mailingAddress1
          jsonData.constituentAddress2 = $('#constituentAddress2').val(); //mailingAddress2
          jsonData.constituentCity = $('#constituentCity').val();
          jsonData.constituentState = $('#constituentState').val();
          jsonData.constituentgZip = $('#constituentZip').val();
        }
      jsonData.applicationType = selected[0];

      //populate uncommon selections from array
      for (var i = 1; i < selected.length; i++)
        populateUncommonJson(selected[i]);

      jsonData.supportingDocuments = attachment; // refer to file mgmt function
      if (jsonData.applicationType == 'appeal')
        jsonData.statementAppeal = $('input[name="statementAppeal"]:checked').val();
      else if (jsonData.applicationType == 'credit')
        jsonData.statementCredit = $('input[name="statementCredit"]:checked').val();
      
      //jsonData.signature = ''; 
      jsonData.signaturePrinted = $('#signaturePrinted').val();
      jsonData.signatureTitle = $('#signatureTitle').val();
      jsonData.signatureOrganization = $('#signatureOrganization').val();

      console.log('Post object', JSON.stringify(cmObject));
      //postToIssueFlow();
    }
  });

  
  //populate json based on user selection
  function populateUncommonJson(element) {
    //console.log('populateUncommonJson()');

    switch (element) {
      case 'appealType1':
        jsonData.appealType1 = $('#appealType1').val();
        jsonData.a1TierCurrent = $('#a1TierCurrent').val();
        jsonData.a1TierProposed = $('#a1TierProposed').val();
        jsonData.a1Reason = $('#a1Reason').val();
        jsonData.a1Comments = $('#a1Comments').val();
        break;

      case 'creditType1':
        jsonData.creditType = $('#creditType2').val();
        jsonData.c1Description = $('#c1Description').val();
        break;

      case 'creditType2':
        jsonData.creditType = $('#creditType2').val();          
        jsonData.c2NPDESPermitNumber = $('#c2NPDESPermitNumber').val();
        jsonData.c2RegistrationNumber = $('#c2RegistrationNumber').val();
        break;

      default:
        console.log("Error populating uncommon JSON")
    }
  }


// EXAMPLE FROM PIA FORM:
  const postToIssueFlow = () => {
    let config = {
      headers: {
        Authorization: '933540812E9970aB83486CA5m06Bte126BD5Faf523F',
      },
    };
    let url = 'https://issueflowtest.aacounty.org/caseManagerDirect';
    axios
      .post(url, cmObject, config)
      .then(function (response) {
        console.log(response);
        window.scrollTo(0, 0);
        // $('#formTitle').hide();
        // $('#piaForm').hide();
        // $('#message').show();
      })
    .catch(function (error) {
      console.log({ error: error, message: 'Error posting to Case Manager' });
    });
  };

</script>
</html>